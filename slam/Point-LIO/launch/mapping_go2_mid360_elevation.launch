<launch>
    <arg name="rviz" default="true" />
    <arg name="point_lio_config" default="$(find point_lio)/config/go2_mid360_sim.yaml" />
    <arg name="filter_distance_threshold" default="0.5" />

    <node pkg="point_lio" type="pointlio_mapping" name="laserMapping" output="screen">
        <rosparam command="load" file="$(arg point_lio_config)" />
        <param name="use_imu_as_input" type="bool" value="0" />
        <param name="prop_at_freq_of_imu" type="bool" value="1" />
        <param name="check_satu" type="bool" value="1" />
        <param name="init_map_size" type="int" value="10" />
        <param name="point_filter_num" type="int" value="1" />
        <param name="space_down_sample" type="bool" value="1" />
        <param name="filter_size_surf" type="double" value="0.5" />
        <param name="filter_size_map" type="double" value="0.4" />
        <param name="ivox_nearby_type" type="int" value="6" />
        <param name="runtime_pos_log_enable" type="bool" value="0" />
        <param name="publish/scan_publish_en" type="bool" value="true" />
        <param name="publish/scan_bodyframe_pub_en" type="bool" value="true" />
    </node>

    <node pkg="elevation_mapping_demos" type="pc_filter.py" name="pointlio_pc_filter" output="screen">
        <param name="input_topic" value="/cloud_registered_body" />
        <param name="output_topic" value="/cloud_registered/filtered" />
        <param name="target_frame" value="base" />
        <param name="distance_threshold" value="$(arg filter_distance_threshold)" />
        <param name="tf_timeout" value="0.1" />
        <param name="queue_size" value="10" />
    </node>

    <include file="$(find pose_publisher)/launch/pose_publisher.launch">
        <arg name="frequency" value="200" />
        <arg name="map_frame" value="camera_init" />
        <arg name="base_frame" value="base" />
        <arg name="topic_republish" value="/pose" />
        <arg name="node_name" value="pose_publisher_pointlio" />
    </include>

    <node pkg="elevation_mapping" type="elevation_mapping" name="elevation_mapping" output="screen">
        <rosparam command="load" file="$(find elevation_mapping_demos)/config/robots/point_lio_go2.yaml" />
        <rosparam command="load" file="$(find elevation_mapping_demos)/config/postprocessing/postprocessor_pipeline.yaml" />
    </node>

    <group if="$(arg rviz)">
        <include file="$(find elevation_mapping_demos)/launch/visualization.launch" />
        <node launch-prefix="nice" pkg="rviz" type="rviz" name="rviz" args="-d $(find elevation_mapping_demos)/rviz/elevation_map_visualization.rviz" />
    </group>
</launch>
